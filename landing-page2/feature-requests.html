<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Feature Requests • Library AI</title>
  <link rel="stylesheet" href="style.css" />
  <meta name="description" content="Propose features and vote on ideas for Library AI." />
  <link rel="icon" href="data:," />
  <style>
    .features-wrap{ max-width: 900px; margin: 24px auto; padding: 0 16px; }
    .feature-form{ display: grid; grid-template-columns: 1fr; gap: 12px; margin-bottom: 20px; }
    .feature-form input, .feature-form textarea{ font-size: 16px; padding: 10px; border: 1px solid #c3c4c7; border-radius: 6px; }
    .feature-form textarea{ min-height: 80px; resize: vertical; }
    .feature-form button{ align-self: start; background: var(--ink); color: var(--bg); border: none; padding: 10px 16px; border-radius: 6px; cursor: pointer; }
    .feature-form button:hover{ background: var(--red); }

    .list{ border: 1px solid #e5e5e5; border-radius: 8px; background: #fff; }
    .item{ display: grid; grid-template-columns: auto 1fr; gap: 12px; padding: 14px 12px; border-bottom: 1px solid #eee; }
    .item:last-child{ border-bottom: none; }

    .vote{ display:flex; flex-direction:column; align-items:center; gap:6px; }
    .vote button{ width: 34px; height: 28px; border-radius: 6px; border: 1px solid #d0d0d0; background: #fff; color: #000; cursor: pointer; }
    .vote button:hover{ border-color: var(--red); color: var(--red); }
    .score{ font-weight: 700; font-size: 14px; }

    .title{ font-size: 16px; font-weight: 700; margin:0 0 6px; }
    .desc{ font-size: 14px; color: #333; margin:0; }
    .meta{ font-size: 12px; color:#777; margin-top: 6px; }

    .topbar{ display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom: 14px; }
    .search{ flex:1; display:flex; gap:8px; }
    .search input{ flex:1; padding:8px 10px; border:1px solid #c3c4c7; border-radius:6px; }
    .filters{ display:flex; gap:8px; }
    .filters select{ padding:8px 10px; border:1px solid #c3c4c7; border-radius:6px; }

    .back-link{ display:inline-block; margin: 12px 16px; }
    .empty{ padding: 16px; color:#666; text-align:center; }
  </style>
</head>
<body>
  <main class="page">
    <header class="brand" aria-label="Public AI">
      <div class="brand-badge">
        <img src="assets/imgs/lib-logo.png" alt="Public AI Logo" class="brand-mark" />
      </div>
    </header>

    <section class="content-page">
      <div class="features-wrap">
        <h1>Feature Requests</h1>
        <div class="feature-form" id="feature-form">
          <input type="text" id="feature-title" placeholder="Suggest a feature (short title)" aria-label="Feature title" />
          <textarea id="feature-desc" placeholder="Optional details" aria-label="Feature details"></textarea>
          <button id="add-feature" type="button">Add feature</button>
          <div id="status" role="status" aria-live="polite"></div>
        </div>

        <div class="topbar">
          <div class="search">
            <input type="search" id="q" placeholder="Search features" aria-label="Search features" />
          </div>
          <div class="filters">
            <select id="sort">
              <option value="score">Top</option>
              <option value="new">Newest</option>
            </select>
          </div>
        </div>

        <div class="list" id="feature-list" aria-live="polite"></div>
        <a class="back-link" href="index.html">← Back to dashboard</a>
      </div>
    </section>
  </main>

  <script>
    const STORAGE_KEY = 'featureRequests.v1';
    const VOTES_KEY = 'featureVotes.v1';
    const el = (id) => document.getElementById(id);

    function uid(){ return Math.random().toString(36).slice(2)+Date.now().toString(36); }

    function loadAll(){
      try { return JSON.parse(localStorage.getItem(STORAGE_KEY)) || []; }
      catch(_){ return []; }
    }
    function saveAll(items){ localStorage.setItem(STORAGE_KEY, JSON.stringify(items)); }

    function loadVotes(){ try { return JSON.parse(localStorage.getItem(VOTES_KEY)) || {}; } catch(_){ return {}; } }
    function saveVotes(v){ localStorage.setItem(VOTES_KEY, JSON.stringify(v)); }

    function setStatus(msg, isError=false){ const s=el('status'); if(!s) return; s.textContent=msg||''; s.style.color = isError ? '#d93025' : '#0b8043'; if(msg) setTimeout(()=>{ if(s.textContent===msg) s.textContent=''; }, 2500); }

    function render(){
      const q = (el('q').value||'').toLowerCase();
      const sort = el('sort').value;
      const votes = loadVotes();
      let items = loadAll();
      if(q) items = items.filter(it => it.title.toLowerCase().includes(q) || (it.desc||'').toLowerCase().includes(q));
      items.sort((a,b)=> sort==='new' ? (b.createdAt - a.createdAt) : (b.score - a.score) );
      const list = el('feature-list');
      if(!items.length){ list.innerHTML = '<div class="empty">No requests yet. Be the first to suggest something!</div>'; return; }
      list.innerHTML = items.map(it=>{
        const my = votes[it.id]||0;
        return `<div class="item" data-id="${it.id}">
          <div class="vote">
            <button class="up" title="Upvote" aria-label="Upvote">▲</button>
            <div class="score" aria-label="Score">${it.score}</div>
            <button class="down" title="Downvote" aria-label="Downvote">▼</button>
          </div>
          <div>
            <div class="title">${escapeHtml(it.title)}</div>
            ${it.desc?`<p class="desc">${escapeHtml(it.desc)}</p>`:''}
            <div class="meta">${new Date(it.createdAt).toLocaleString()}</div>
          </div>
        </div>`;
      }).join('');
    }

    function escapeHtml(s){ return (s||'').replace(/[&<>"']/g, c=>({"&":"&amp;","<":"&lt;",
      ">":"&gt;","\"":"&quot;","'":"&#39;"}[c])); }

    function addFeature(){
      const title = (el('feature-title').value||'').trim();
      const desc = (el('feature-desc').value||'').trim();
      if(!title){ setStatus('Please enter a title', true); return; }
      const items = loadAll();
      const feature = { id: uid(), title, desc, score: 0, createdAt: Date.now() };
      items.push(feature); saveAll(items);
      el('feature-title').value=''; el('feature-desc').value='';
      setStatus('Feature added.');
      render();
    }

    function vote(id, delta){
      const items = loadAll();
      const idx = items.findIndex(i=>i.id===id); if(idx<0) return;
      const votes = loadVotes();
      const prev = votes[id]||0;
      const next = Math.max(-1, Math.min(1, prev + delta));
      const adjust = next - prev; // -1, 0, or 1
      if(adjust===0) return; // no change
      items[idx].score += adjust;
      saveAll(items); votes[id]=next; saveVotes(votes);
      render();
    }

    document.addEventListener('click', (e)=>{
      const up = e.target.closest('button.up');
      const down = e.target.closest('button.down');
      const item = e.target.closest('.item');
      if(item && (up||down)){
        e.preventDefault();
        vote(item.getAttribute('data-id'), up? 1 : -1);
      }
    });

    el('add-feature').addEventListener('click', addFeature);
    el('q').addEventListener('input', render);
    el('sort').addEventListener('change', render);

    render();
  </script>
</body>
</html>
